!function(e,n){if("function"==typeof define&&define.amd)define(["backbone","underscore"],n);else{if("undefined"!=typeof exports)return module.exports=n(require("backbone"),require("underscore"));n(e.Backbone,e._)}}(this,function(e,n){function t(){var t,o=n.extend({},Object.getPrototypeOf(this),this.constructor.__super__);for(var i in o)o.hasOwnProperty(i)&&(t=o[i],t instanceof e.Computed&&r(this,t,i))}e.Computed=function(n){return this instanceof e.Computed?(n=Array.prototype.slice.call(n,0),this.computedFunction=n[n.length-1],this.dep=n.slice(0,-1),void 0):new e.Computed(arguments)},e.Computed.prototype.getDependentProperties=function(){return this.dep};var o=e.Model;e.Model=o.extend({constructor:function(){o.apply(this,arguments),t.call(this)}});var r=function(e,t,o){var r=function(){e.set(o,t.computedFunction.call(e))},i=n.memoize(function(){return n.filter(t.getDependentProperties(),function(e){return e.indexOf("event:")<0})}),u=n.memoize(function(){return n.chain(t.getDependentProperties()).filter(function(e){return 0===e.indexOf("event:")}).map(function(e){return e.replace("event:","")}).value()}),c=function(){return i().map(function(e){return"change:"+e})},f=function(){if(i().length){var n=c().join(" ");e.on(n,r)}},p=function(){if(u().length){var n=u().join(" ");e.on(n,r)}};f(),p(),r()};return e.Computed});